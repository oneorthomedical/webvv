!function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=5)}([function(e,n){e.exports={fps:30,interpolation:0,autoIntensity:!1,bgColor:0,rightClickAllowed:!1,zoomSpeed:1.1,zoomIn:"+",zoomIn2:"i",zoomOut:"-",zoomOut2:"o",zoomHold:17,resetCamera:"r"}},,,function(e,n){e.exports=function(){let e,n,t,o,i,r;function s(){t=Date.now(),(i=t-o)>e&&(o=t-i%e,r()),requestAnimationFrame(s)}return{startAnimating:function(t,i){r=i,imgHasChanged=!0,e=1e3/t,o=Date.now(),n=o,s()}}}()},function(e,n){e.exports=function(){function e(e,n){return n.extension.toUpperCase()===e.toUpperCase()}return{readMultipleFiles:function(n,t){const o=[];let i,r=[],s=function(){let e=[],n=window.location.search.substring(1).split("&");for(let t=0,o=n.length;t<o;t++){if(""===n[t])continue;let o=n[t].split("=");"viewer"===decodeURIComponent(o[0])&&(e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||""))}return e}(),l=new XMLHttpRequest,a=0,u=[],c="/"+s.viewer;function d(e,t){return Promise.resolve().then(function(){return new Promise(function(n,o){const i=new FileReader;i.addEventListener("load",function(e){n(e.target.result)}),i.readAsArrayBuffer(t[e])})}).then(function(o){return n.parse({url:t[e].name,buffer:o})}).then(function(e){r.push(e)}).catch(function(e){window.console.log("Oops... something went wrong while loading the sequence..."),window.console.log(e)})}l.overrideMimeType("application/json"),l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE&&"200"==l.status){let s=l.responseText;i=JSON.parse(s),function s(){let l=i.image[a].split("/").pop(),c=new XMLHttpRequest,f="/datafiles/"+i.study+"/"+i.image[a];c.open("GET",f),c.responseType="blob",c.onload=function(){window.console.log("Try to load "+l)},c.addEventListener("readystatechange",function(){c.readyState===XMLHttpRequest.DONE&&"200"==c.status&&(u.push(new File([c.response],l)),++a===i.image.length?function(){const i=[],s=[];for(let e=0;e<u.length;e++){let n=AMI.UtilsCore.parseUrl(u[e].name);"MHD"===n.extension.toUpperCase()||"RAW"===n.extension.toUpperCase()?s.push({file:u[e],extension:n.extension.toUpperCase()}):i.push(u[e])}if(2===s.length){const t=s.filter(e.bind(null,"MHD")),i=s.filter(e.bind(null,"RAW"));1===t.length&&1===i.length&&o.push(function(e){const t=[];for(let n=0;n<e.length;n++)t.push(new Promise((t,o)=>{const i=new FileReader;i.addEventListener("load",function(e){t(e.target.result)}),i.readAsArrayBuffer(e[n].file)}).then(function(t){return{url:e[n].file.name,buffer:t}}));return Promise.all(t).then(e=>n.parse(e)).then(function(e){r.push(e)}).catch(function(e){window.console.log("oops... something went wrong while parsing the sequence..."),window.console.log(e)})}(s))}for(let e=0;e<i.length;e++)o.push(d(e,i));Promise.all(o).then(function(){t(r)}).catch(function(e){window.console.log("oops... something went wrong while using the sequence..."),window.console.log(e)})}():s())}),c.send()}()}},l.open("GET",c,!0),l.send(null)}}}()},function(e,n,t){const o=t(0),i=t(4),r=t(3);let s,l,a,u,c,d,f;window.onload=function(){l=document.getElementById("r3d"),(s=new THREE.WebGLRenderer({antialias:1==o.interpolation})).setSize(l.offsetWidth,l.offsetHeight),s.setClearColor(o.bgColor,1),s.setPixelRatio(window.devicePixelRatio),l.appendChild(s.domElement),a=new Stats,l.appendChild(a.domElement),u=new THREE.Scene,d=new AMI.OrthographicCamera(l.clientWidth/-2,l.clientWidth/2,l.clientHeight/2,l.clientHeight/-2,.1,1e4),(f=new AMI.TrackballOrthoControl(d,l)).staticMoving=!0,f.noRotate=!0,d.controls=f;let e=new AMI.VolumeLoader(l);i.readMultipleFiles(e,function(n){console.log("Series has been loaded!"),e.free(),e=null;let t=n[0].mergeSeries(n)[0].stack[0];(c=new AMI.StackHelper(t)).bbox.visible=!1,c.borderColor="#2196F3",c.border.visible=!1,u.add(c);let i=t.worldBoundingBox(),p=new THREE.Vector3((i[1]-i[0])/2,(i[3]-i[2])/2,(i[5]-i[4])/2),h={center:t.worldCenter().clone(),halfDimensions:new THREE.Vector3(p.x+10,p.y+10,p.z+10)},w={width:l.clientWidth,height:l.clientHeight};d.directions=[t.xCosine,t.yCosine,t.zCosine],d.box=h,d.canvas=w,d.update(),d.fitBox(2),c.slice.intensityAuto=o.autoIntensity,c.slice.interpolation=o.interpolation,function(){function e(){d.canvas={width:l.offsetWidth,height:l.offsetHeight},s.setSize(l.offsetWidth,l.offsetHeight)}r.startAnimating(o.fps,function(){f.update(),s.render(u,d),a.update()}),window.addEventListener("resize",e,!1),e()}()})}}]);