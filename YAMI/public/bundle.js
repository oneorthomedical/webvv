!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t){e.exports={fps:30,interpolation:0,autoIntensity:!1,bgColor:0,rightClickAllowed:!1,zoomSpeed:1.1,zoomIn:"+",zoomIn2:"i",zoomOut:"-",zoomOut2:"o",zoomHold:17,resetCamera:"r"}},,function(e,t){e.exports=function(){function e(e,t){"CR"!==t&&"DX"!==t&&(document.getElementById("top").innerHTML=e[0],document.getElementById("bottom").innerHTML=e[1],document.getElementById("right").innerHTML=e[2],document.getElementById("left").innerHTML=e[3])}return{buildGUI:function(t,n){let o=t._stack,i=new dat.GUI({autoPlace:!1}),l={invertRows:!1,invertColumns:!1,rotate:!1,orientation:"default",convention:"radio"};document.getElementById("my-gui-container").appendChild(i.domElement);let r=i.addFolder("Stack");r.add(t.slice,"windowWidth",1,o.minMax[1]-o.minMax[0]).step(1).listen(),r.add(t.slice,"windowCenter",o.minMax[0],o.minMax[1]).step(1).listen(),r.add(t.slice,"invert"),lut=new AMI.LutHelper("my-lut-canvases","default","linear",[[0,0,0,0],[1,1,1,1]],[[0,1],[1,1]]),lut.luts=AMI.LutHelper.presetLuts(),r.add(t.slice,"lut",lut.lutsAvailable()).onChange(function(e){lut.lut=e,t.slice.lutTexture=lut.texture}),r.add(lut,"discrete",!1).onChange(function(e){lut.discrete=e,t.slice.lutTexture=lut.texture});let a=r.add(t,"index",0,o.dimensionsIJK.z-1).step(1).listen();r.open();let s=i.addFolder("Camera");s.add(l,"invertRows").onChange(function(){n.invertRows(),e(n.directionsLabel,o.modality)}),s.add(l,"invertColumns").onChange(function(){n.invertColumns(),e(n.directionsLabel,o.modality)}),s.add(n,"angle",0,360).step(1).listen().onChange(function(){e(n.directionsLabel,o.modality)}),s.add(l,"rotate").onChange(function(){n.rotate(),e(n.directionsLabel,o.modality)}),s.add(l,"orientation",["default","axial","coronal","sagittal"]).onChange(function(i){n.orientation=i,n.update(),n.fitBox(2),t.orientation=n.stackOrientation,e(n.directionsLabel,o.modality),a.__max=t.orientationMaxIndex,t.index=Math.floor(a.__max/2)}),s.add(l,"convention",["radio","neuro"]).onChange(function(t){n.convention=t,n.update(),n.fitBox(2),e(n.directionsLabel,o.modality)})},updateLabels:e}}()},function(e,t){e.exports=function(){let e,t,n,o,i,l;function r(){n=Date.now(),(i=n-o)>e&&(o=n-i%e,l()),requestAnimationFrame(r)}return{startAnimating:function(n,i){l=i,imgHasChanged=!0,e=1e3/n,o=Date.now(),t=o,r()}}}()},function(e,t){e.exports=function(){function e(e,t){return t.extension.toUpperCase()===e.toUpperCase()}return{readMultipleFiles:function(t,n){const o=[];let i,l=[],r=function(){let e=[],t=window.location.search.substring(1).split("&");for(let n=0,o=t.length;n<o;n++){if(""===t[n])continue;let o=t[n].split("=");"viewer"===decodeURIComponent(o[0])&&(e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||""))}return e}(),a=new XMLHttpRequest,s=0,d=[],u="/"+r.viewer;function c(e,n){return Promise.resolve().then(function(){return new Promise(function(t,o){const i=new FileReader;i.addEventListener("load",function(e){t(e.target.result)}),i.readAsArrayBuffer(n[e])})}).then(function(o){return t.parse({url:n[e].name,buffer:o})}).then(function(e){l.push(e)}).catch(function(e){window.console.log("Oops... something went wrong while loading the sequence..."),window.console.log(e)})}a.overrideMimeType("application/json"),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE&&"200"==a.status){let r=a.responseText;i=JSON.parse(r),function r(){let a=i.image[s].split("/").pop(),u=new XMLHttpRequest,f="/datafiles/"+i.study+"/"+i.image[s];u.open("GET",f),u.responseType="blob",u.onload=function(){window.console.log("Try to load "+a)},u.addEventListener("readystatechange",function(){u.readyState===XMLHttpRequest.DONE&&"200"==u.status&&(d.push(new File([u.response],a)),++s===i.image.length?function(){const i=[],r=[];for(let e=0;e<d.length;e++){let t=AMI.UtilsCore.parseUrl(d[e].name);"MHD"===t.extension.toUpperCase()||"RAW"===t.extension.toUpperCase()?r.push({file:d[e],extension:t.extension.toUpperCase()}):i.push(d[e])}if(2===r.length){const n=r.filter(e.bind(null,"MHD")),i=r.filter(e.bind(null,"RAW"));1===n.length&&1===i.length&&o.push(function(e){const n=[];for(let t=0;t<e.length;t++)n.push(new Promise((n,o)=>{const i=new FileReader;i.addEventListener("load",function(e){n(e.target.result)}),i.readAsArrayBuffer(e[t].file)}).then(function(n){return{url:e[t].file.name,buffer:n}}));return Promise.all(n).then(e=>t.parse(e)).then(function(e){l.push(e)}).catch(function(e){window.console.log("oops... something went wrong while parsing the sequence..."),window.console.log(e)})}(r))}for(let e=0;e<i.length;e++)o.push(c(e,i));Promise.all(o).then(function(){n(l)}).catch(function(e){window.console.log("oops... something went wrong while using the sequence..."),window.console.log(e)})}():r())}),u.send()}()}},a.open("GET",u,!0),a.send(null)}}}()},function(e,t,n){const o=n(0),i=n(4),l=n(3),r=n(2);let a,s,d,u,c,f,p;window.onload=function(){s=document.getElementById("r3d"),(a=new THREE.WebGLRenderer({antialias:1==o.interpolation})).setSize(s.offsetWidth,s.offsetHeight),a.setClearColor(o.bgColor,1),a.setPixelRatio(window.devicePixelRatio),s.appendChild(a.domElement),d=new Stats,s.appendChild(d.domElement),u=new THREE.Scene,f=new AMI.OrthographicCamera(s.clientWidth/-2,s.clientWidth/2,s.clientHeight/2,s.clientHeight/-2,.1,1e4),(p=new AMI.TrackballOrthoControl(f,s)).staticMoving=!0,p.noRotate=!0,f.controls=p;let e=new AMI.VolumeLoader(s);i.readMultipleFiles(e,function(t){console.log("Series has been loaded!"),e.free(),e=null;let n=t[0].mergeSeries(t)[0].stack[0];(c=new AMI.StackHelper(n)).bbox.visible=!1,c.borderColor="#2196F3",c.border.visible=!1,u.add(c);let i=n.worldBoundingBox(),h=new THREE.Vector3((i[1]-i[0])/2,(i[3]-i[2])/2,(i[5]-i[4])/2),m={center:n.worldCenter().clone(),halfDimensions:new THREE.Vector3(h.x+10,h.y+10,h.z+10)},g={width:s.clientWidth,height:s.clientHeight};f.directions=[n.xCosine,n.yCosine,n.zCosine],f.box=m,f.canvas=g,f.update(),f.fitBox(2),c.slice.intensityAuto=o.autoIntensity,c.slice.interpolation=o.interpolation,r.updateLabels(f.directionsLabel,n.modality),r.buildGUI(c,f),function(){function e(){f.canvas={width:s.offsetWidth,height:s.offsetHeight},a.setSize(s.offsetWidth,s.offsetHeight)}l.startAnimating(o.fps,function(){p.update(),a.render(u,f),d.update()}),window.addEventListener("resize",e,!1),e()}()})}}]);